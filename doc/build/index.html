
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Welcome to EPA Toolkit’s documentation! &#8212; EPA 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-epa">
<span id="welcome-to-epa-toolkit-s-documentation"></span><h1>Welcome to EPA Toolkit’s documentation!<a class="headerlink" href="#module-epa" title="Permalink to this headline">¶</a></h1>
<p>Python module to download EPA AQS Data hosted at <a class="reference external" href="https://www.epa.gov/aqs">https://www.epa.gov/aqs</a></p>
<p>The module can be used as a standalone tool or as a library of functions
to be called from other python scripts.</p>
<p>If used as a tool, it expects user to specify a list of years,
a list of EPA Parameter Codes
<a class="reference external" href="https://www.epa.gov/aqs/aqs-code-list">https://www.epa.gov/aqs/aqs-code-list</a>
and some instructions how to format output</p>
<p>The data is downloaded from <a class="reference external" href="https://aqs.epa.gov/aqsweb/airdata/download_files.html">https://aqs.epa.gov/aqsweb/airdata/download_files.html</a></p>
<p>The tool adds a column containing a uniquely generated Monitor Key</p>
<p>Probably the only method useful to external user is <a class="reference internal" href="#epa.download_aqs_data" title="epa.download_aqs_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">download_aqs_data()</span></code></a></p>
<dl class="class">
<dt id="epa.Aggregation">
<em class="property">class </em><code class="descclassname">epa.</code><code class="descname">Aggregation</code><a class="reference internal" href="_modules/epa.html#Aggregation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.Aggregation" title="Permalink to this definition">¶</a></dt>
<dd><p>An Enum used to specify how the data is aggregated in time</p>
</dd></dl>

<dl class="class">
<dt id="epa.Parameter">
<em class="property">class </em><code class="descclassname">epa.</code><code class="descname">Parameter</code><a class="reference internal" href="_modules/epa.html#Parameter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.Parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>An Enum with mnemonic names for the most common EPA AQS Parameter Codes
See more at <a class="reference external" href="https://www.epa.gov/aqs/aqs-code-list">https://www.epa.gov/aqs/aqs-code-list</a></p>
</dd></dl>

<dl class="function">
<dt id="epa.add_monitor_key">
<code class="descclassname">epa.</code><code class="descname">add_monitor_key</code><span class="sig-paren">(</span><em>row: Dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#add_monitor_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.add_monitor_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal method to generate and add unique Monitor Key</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>row</strong> – a row of AQS CSV file</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Nothing, modifies the given row in place</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.as_csv_reader">
<code class="descclassname">epa.</code><code class="descname">as_csv_reader</code><span class="sig-paren">(</span><em>url: str</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#as_csv_reader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.as_csv_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>An utility method to return the CSV content of the URL as CSVReader</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>url</strong> – URL</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">an instance of csv.DictReader</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.as_stream">
<code class="descclassname">epa.</code><code class="descname">as_stream</code><span class="sig-paren">(</span><em>url: str</em>, <em>extension: str = '.csv'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#as_stream"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.as_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns teh content of URL as a stream. In case the content is in zip
format (excluding gzip) creates a temporary file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>url</strong> – URL</li>
<li><strong>extension</strong> – optional, when the content is zip-encoded, the extension
of the zip entry to return</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Content of the URL or a zip entry</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.check_http_response">
<code class="descclassname">epa.</code><code class="descname">check_http_response</code><span class="sig-paren">(</span><em>r: requests.models.Response</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#check_http_response"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.check_http_response" title="Permalink to this definition">¶</a></dt>
<dd><p>An internal method raises an exception of HTTP response is not OK</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>r</strong> – Response</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">nothing, raises an exception if response is not OK</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.collect_annual_downloads">
<code class="descclassname">epa.</code><code class="descname">collect_annual_downloads</code><span class="sig-paren">(</span><em>destination: str</em>, <em>path: str</em>, <em>contiguous_year_segment: List</em>, <em>parameters: List</em>, <em>downloads: Dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#collect_annual_downloads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.collect_annual_downloads" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility method to collect all URLs that should be downloaded for a given
list of years and EPA AQS parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>destination</strong> – Destination directory for downloads</li>
<li><strong>path</strong> – path element</li>
<li><strong>contiguous_year_segment</strong> – a list of contiguous years taht can be
saved in the same file</li>
<li><strong>parameters</strong> – List of EPA AQS Parameter codes</li>
<li><strong>downloads</strong> – The resulting collection of downloads that have to
be performed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">downloads list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.collect_daily_downloads">
<code class="descclassname">epa.</code><code class="descname">collect_daily_downloads</code><span class="sig-paren">(</span><em>destination: str</em>, <em>ylabel: str</em>, <em>contiguous_year_segment: List</em>, <em>parameter</em>, <em>downloads: Dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#collect_daily_downloads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.collect_daily_downloads" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility method to collect all URLs that should be downloaded for a given
list of years and EPA AQS parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>destination</strong> – Destination directory for downloads</li>
<li><strong>ylabel</strong> – a label to use for years in teh destination path</li>
<li><strong>contiguous_year_segment</strong> – a list of contiguous years taht can be
saved in the same file</li>
<li><strong>parameters</strong> – List of EPA AQS Parameter codes</li>
<li><strong>downloads</strong> – The resulting collection of downloads that have to
be performed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">downloads list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.destination_path">
<code class="descclassname">epa.</code><code class="descname">destination_path</code><span class="sig-paren">(</span><em>destination: str</em>, <em>path: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="_modules/epa.html#destination_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.destination_path" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility method to construct destination file path</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>destination</strong> – Destination directory</li>
<li><strong>path</strong> – Source path in URL</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Path on a file system</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.download">
<code class="descclassname">epa.</code><code class="descname">download</code><span class="sig-paren">(</span><em>url: str</em>, <em>to: IO</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#download"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.download" title="Permalink to this definition">¶</a></dt>
<dd><p>An utility method to download large binary data to a file-like object</p>
</dd></dl>

<dl class="function">
<dt id="epa.download_aqs_data">
<code class="descclassname">epa.</code><code class="descname">download_aqs_data</code><span class="sig-paren">(</span><em>aggregation: epa.Aggregation</em>, <em>years: List</em>, <em>destination: str</em>, <em>parameters: List</em>, <em>merge_years: bool = False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#download_aqs_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.download_aqs_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Main entry into teh library</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>aggregation</strong> – Type of time aggregation: annual or daily</li>
<li><strong>years</strong> – a list of years to include, if None - then all
years are included</li>
<li><strong>destination</strong> – Destination Directory</li>
<li><strong>parameters</strong> – List of EPA AQS Parameter codes. For annual
aggregation can be empty, in which case all data is downloaded.
Required for daily aggregation. Can contain either integer codes, or
mnemonic instanced of Parameter Enum or both.</li>
<li><strong>merge_years</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.download_data">
<code class="descclassname">epa.</code><code class="descname">download_data</code><span class="sig-paren">(</span><em>url: str</em>, <em>target: str</em>, <em>parameters: List</em>, <em>append: bool</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#download_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.download_data" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility method to download the content of given URL to the given file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>url</strong> – Source URL</li>
<li><strong>target</strong> – Target file path</li>
<li><strong>parameters</strong> – An optional list of EPA AQS Parameter codes to include
in the output</li>
<li><strong>append</strong> – whether to append to an existing file</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.enum">
<code class="descclassname">epa.</code><code class="descname">enum</code><span class="sig-paren">(</span><em>cls</em>, <em>s: str</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#enum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.enum" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper method to return Enum value by its name</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cls</strong> – Enum class</li>
<li><strong>s</strong> – name of a member in Enum class</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value of the member</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.fopen">
<code class="descclassname">epa.</code><code class="descname">fopen</code><span class="sig-paren">(</span><em>path: str</em>, <em>mode: str</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#fopen"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.fopen" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper to open various types of files</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> – Path to file</li>
<li><strong>mode</strong> – Opening mode</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">file-like object</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.is_downloaded">
<code class="descclassname">epa.</code><code class="descname">is_downloaded</code><span class="sig-paren">(</span><em>url: str</em>, <em>target: str</em><span class="sig-paren">)</span> &#x2192; bool<a class="reference internal" href="_modules/epa.html#is_downloaded"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.is_downloaded" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if the same data has already been downloaded</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>url</strong> – URL with data</li>
<li><strong>target</strong> – Destination of teh downloads</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if the destination file exists and is newer than
URL content</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="epa.write_csv">
<code class="descclassname">epa.</code><code class="descname">write_csv</code><span class="sig-paren">(</span><em>reader: csv.DictReader</em>, <em>writer: csv.DictWriter</em>, <em>flt=None</em>, <em>header: bool = True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/epa.html#write_csv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#epa.write_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Specific for EPA Data</p>
<p>Rewrites the CSV content adding Monitor Key and optionally
filtering rows by a provided list of parameter codes</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>reader</strong> – Input data as an instance of csv.DictReader</li>
<li><strong>writer</strong> – Output source should be provided as csv.DictWriter</li>
<li><strong>flt</strong> – Optionally, a callable function returning True
for rows that should be written to the output and False for those
that should be omitted</li>
<li><strong>header</strong> – whether to first write header row</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>See <span class="xref std std-ref">Usage</span></p>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to EPA Toolkit’s documentation!</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Harvard University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>